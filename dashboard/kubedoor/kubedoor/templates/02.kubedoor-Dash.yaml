apiVersion: v1
kind: Secret
metadata:
  name: kubedoor-grafana
  namespace: kubedoor
data:
  admin-password: YWRtaW4=
  admin-user: YWRtaW4=
  ldap-toml: ""
type: Opaque

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kubedoor-grafana-config
  namespace: kubedoor
data:
  dashboardproviders.yaml: |
    apiVersion: 1
    providers:
    - disableDeletion: false
      editable: true
      folder: ""
      name: default
      options:
        path: /var/lib/grafana/dashboards
      orgId: 1
      type: file
  datasources.yaml: |
    apiVersion: 1
    datasources:
    - jsonData:
        port: {{ .Values.config.CK_PORT }}
        server: {{ .Values.config.CK_HOST }}
        username: {{ .Values.config.CK_USER }}
      name: KubeDoor-Clickhouse
      secureJsonData:
        password: {{ .Values.config.CK_PASSWORD }}
      type: grafana-clickhouse-datasource
      uid: KubeDoor-Clickhouse
  grafana.ini: |
    app_mode = production
    [analytics]
    check_for_updates = false
    reporting_enabled = false
    [auth]
    disable_login_form = false
    disable_signout_menu = false
    [auth.anonymous]
    enabled = true
    hide_version = true
    org_name = Main Org.
    org_role = Admin
    [database]
    type = sqlite3
    [grafana_net]
    url = https://grafana.net
    [log]
    mode = console
    [news]
    news_feed_enabled = false
    [paths]
    data = /var/lib/grafana/
    logs = /var/log/grafana
    plugins = /var/lib/grafana/plugins
    provisioning = /etc/grafana/provisioning
    [profile]
    enabled = false
    [quota]
    enabled = false
    [security]
    allow_embedding = true
    disable_gravatar = true
    disable_initial_admin_creation = false
    [server]
    http_port = 3000
    domain = kubedoor-dash.kubedoor
    enable_gzip = true
    enforce_domain = false
    protocol = http
    root_url = %(protocol)s://%(domain)s/grafana/
    serve_from_sub_path = true
    [snapshots]
    external_enabled = false
    [users]
    allow_org_create = true
    allow_sign_up = true
    auto_assign_org_role = Admin
    default_language = zh-Hans
    home_page = /grafana/d/KubeDoor

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kubedoor-grafana-dash
  namespace: kubedoor
data:
  KubeDoor-Dash.json: "{\r\n  \"annotations\": {\r\n    \"list\": [\r\n      {\r\n        \"builtIn\": 1,\r\n        \"datasource\": {\r\n          \"type\": \"grafana\",\r\n          \"uid\": \"-- Grafana --\"\r\n        },\r\n        \"enable\": true,\r\n        \"hide\": true,\r\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\r\n        \"name\": \"Annotations & Alerts\",\r\n        \"type\": \"dashboard\"\r\n      }\r\n    ]\r\n  },\r\n  \"editable\": true,\r\n  \"fiscalYearStartMonth\": 0,\r\n  \"graphTooltip\": 0,\r\n  \"id\": 707,\r\n  \"links\": [],\r\n  \"panels\": [\r\n    {\r\n      \"collapsed\": false,\r\n      \"gridPos\": {\r\n        \"h\": 1,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 0\r\n      },\r\n      \"id\": 32,\r\n      \"panels\": [],\r\n      \"title\": \"【${__from:date:YYYY-MM-DD}~${__to:date:YYYY-MM-DD}最大资源使用的日期：${maxday}】【$env】高峰时段全局资源统计与各资源TOP10\",\r\n      \"type\": \"row\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic-by-name\"\r\n          },\r\n          \"mappings\": [],\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        \"overrides\": [\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byRegexp\",\r\n              \"options\": \"/内存.*/\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"unit\",\r\n                \"value\": \"mbytes\"\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 3,\r\n        \"w\": 8,\r\n        \"x\": 0,\r\n        \"y\": 1\r\n      },\r\n      \"id\": 30,\r\n      \"options\": {\r\n        \"colorMode\": \"background\",\r\n        \"graphMode\": \"area\",\r\n        \"justifyMode\": \"center\",\r\n        \"orientation\": \"auto\",\r\n        \"percentChangeColorMode\": \"standard\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"/.*/\",\r\n          \"values\": true\r\n        },\r\n        \"showPercentChange\": false,\r\n        \"textMode\": \"value_and_name\",\r\n        \"wideLayout\": true\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select count(DISTINCT namespace) as \\\"命名空间\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"A\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select count(DISTINCT deployment) as \\\"微服务\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"B\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(pod_count) as \\\"Pod\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"C\"\r\n        }\r\n      ],\r\n      \"title\": \"\",\r\n      \"type\": \"stat\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"mappings\": [],\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        \"overrides\": [\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byRegexp\",\r\n              \"options\": \"/内存.*/\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"unit\",\r\n                \"value\": \"mbytes\"\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 3,\r\n        \"w\": 8,\r\n        \"x\": 8,\r\n        \"y\": 1\r\n      },\r\n      \"id\": 31,\r\n      \"options\": {\r\n        \"colorMode\": \"background\",\r\n        \"graphMode\": \"area\",\r\n        \"justifyMode\": \"center\",\r\n        \"orientation\": \"auto\",\r\n        \"percentChangeColorMode\": \"standard\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"/.*/\",\r\n          \"values\": true\r\n        },\r\n        \"showPercentChange\": false,\r\n        \"textMode\": \"value_and_name\",\r\n        \"wideLayout\": true\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(request_pod_cpu_m * pod_count)/1000 as \\\"CPU需求\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"H\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(p95_pod_load * pod_count) as \\\"负载使用\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"I\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(limit_pod_cpu_m * pod_count)/1000 as \\\"CPU限制\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"\",\r\n      \"type\": \"stat\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"mappings\": [],\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        \"overrides\": [\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byRegexp\",\r\n              \"options\": \"/内存.*/\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"unit\",\r\n                \"value\": \"mbytes\"\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 3,\r\n        \"w\": 8,\r\n        \"x\": 16,\r\n        \"y\": 1\r\n      },\r\n      \"id\": 33,\r\n      \"options\": {\r\n        \"colorMode\": \"background\",\r\n        \"graphMode\": \"area\",\r\n        \"justifyMode\": \"center\",\r\n        \"orientation\": \"auto\",\r\n        \"percentChangeColorMode\": \"standard\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"/.*/\",\r\n          \"values\": true\r\n        },\r\n        \"showPercentChange\": false,\r\n        \"textMode\": \"value_and_name\",\r\n        \"wideLayout\": true\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(request_pod_mem_mb * pod_count) as \\\"内存需求\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"F\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(p95_pod_wss_mb * pod_count) as \\\"内存使用\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"A\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"hide\": false,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"select sum(limit_pod_mem_mb * pod_count) as \\\"内存限制\\\"\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n\\r\\n\",\r\n          \"refId\": \"G\"\r\n        }\r\n      ],\r\n      \"title\": \"\",\r\n      \"type\": \"stat\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"decimals\": 1,\r\n          \"fieldMinMax\": false,\r\n          \"mappings\": [],\r\n          \"min\": 0,\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        \"overrides\": []\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 12,\r\n        \"w\": 5,\r\n        \"x\": 0,\r\n        \"y\": 4\r\n      },\r\n      \"id\": 25,\r\n      \"options\": {\r\n        \"displayMode\": \"gradient\",\r\n        \"legend\": {\r\n          \"calcs\": [],\r\n          \"displayMode\": \"list\",\r\n          \"placement\": \"bottom\",\r\n          \"showLegend\": false\r\n        },\r\n        \"maxVizHeight\": 300,\r\n        \"minVizHeight\": 16,\r\n        \"minVizWidth\": 8,\r\n        \"namePlacement\": \"top\",\r\n        \"orientation\": \"horizontal\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"\",\r\n          \"values\": true\r\n        },\r\n        \"showUnfilled\": true,\r\n        \"sizing\": \"auto\",\r\n        \"valueMode\": \"color\"\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"  SELECT\\r\\n    concat(namespace,':',deployment) AS name,\\r\\n    sum(p95_pod_load * pod_count) AS load\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    name\\r\\n    order by load desc\\r\\n    limit 10\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务负载使用TOP10\",\r\n      \"type\": \"bargauge\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"mappings\": [],\r\n          \"min\": 0,\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          },\r\n          \"unit\": \"percent\"\r\n        },\r\n        \"overrides\": []\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 12,\r\n        \"w\": 5,\r\n        \"x\": 5,\r\n        \"y\": 4\r\n      },\r\n      \"id\": 28,\r\n      \"options\": {\r\n        \"displayMode\": \"gradient\",\r\n        \"legend\": {\r\n          \"calcs\": [],\r\n          \"displayMode\": \"list\",\r\n          \"placement\": \"bottom\",\r\n          \"showLegend\": false\r\n        },\r\n        \"maxVizHeight\": 300,\r\n        \"minVizHeight\": 16,\r\n        \"minVizWidth\": 8,\r\n        \"namePlacement\": \"top\",\r\n        \"orientation\": \"horizontal\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"\",\r\n          \"values\": true\r\n        },\r\n        \"showUnfilled\": true,\r\n        \"sizing\": \"auto\",\r\n        \"valueMode\": \"color\"\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"  SELECT\\r\\n    concat(namespace,':',deployment) AS name,\\r\\n    sum(p95_pod_cpu_pct) AS load\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    name\\r\\n    order by load desc\\r\\n    limit 10\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务CPU使用率TOP10\",\r\n      \"type\": \"bargauge\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"decimals\": 1,\r\n          \"mappings\": [],\r\n          \"min\": 0,\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          },\r\n          \"unit\": \"mbytes\"\r\n        },\r\n        \"overrides\": []\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 12,\r\n        \"w\": 5,\r\n        \"x\": 10,\r\n        \"y\": 4\r\n      },\r\n      \"id\": 26,\r\n      \"options\": {\r\n        \"displayMode\": \"gradient\",\r\n        \"legend\": {\r\n          \"calcs\": [],\r\n          \"displayMode\": \"list\",\r\n          \"placement\": \"bottom\",\r\n          \"showLegend\": false\r\n        },\r\n        \"maxVizHeight\": 300,\r\n        \"minVizHeight\": 16,\r\n        \"minVizWidth\": 8,\r\n        \"namePlacement\": \"top\",\r\n        \"orientation\": \"horizontal\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"\",\r\n          \"values\": true\r\n        },\r\n        \"showUnfilled\": true,\r\n        \"sizing\": \"auto\",\r\n        \"valueMode\": \"color\"\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"  SELECT\\r\\n    concat(namespace,':',deployment) AS name,\\r\\n    sum(p95_pod_wss_mb * pod_count) AS load\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    name\\r\\n    order by load desc\\r\\n    limit 10\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务内存使用TOP10\",\r\n      \"type\": \"bargauge\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"mappings\": [],\r\n          \"min\": 0,\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          },\r\n          \"unit\": \"percent\"\r\n        },\r\n        \"overrides\": []\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 12,\r\n        \"w\": 5,\r\n        \"x\": 15,\r\n        \"y\": 4\r\n      },\r\n      \"id\": 29,\r\n      \"options\": {\r\n        \"displayMode\": \"gradient\",\r\n        \"legend\": {\r\n          \"calcs\": [],\r\n          \"displayMode\": \"list\",\r\n          \"placement\": \"bottom\",\r\n          \"showLegend\": false\r\n        },\r\n        \"maxVizHeight\": 300,\r\n        \"minVizHeight\": 16,\r\n        \"minVizWidth\": 8,\r\n        \"namePlacement\": \"top\",\r\n        \"orientation\": \"horizontal\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"\",\r\n          \"values\": true\r\n        },\r\n        \"showUnfilled\": true,\r\n        \"sizing\": \"auto\",\r\n        \"valueMode\": \"color\"\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"  SELECT\\r\\n    concat(namespace,':',deployment) AS name,\\r\\n    sum(p95_pod_wss_pct) AS load\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    name\\r\\n    order by load desc\\r\\n    limit 10\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务内存使用率TOP10\",\r\n      \"type\": \"bargauge\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic\"\r\n          },\r\n          \"mappings\": [],\r\n          \"min\": 0,\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              },\r\n              {\r\n                \"color\": \"red\",\r\n                \"value\": 80\r\n              }\r\n            ]\r\n          },\r\n          \"unit\": \"none\"\r\n        },\r\n        \"overrides\": []\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 12,\r\n        \"w\": 4,\r\n        \"x\": 20,\r\n        \"y\": 4\r\n      },\r\n      \"id\": 27,\r\n      \"options\": {\r\n        \"displayMode\": \"gradient\",\r\n        \"legend\": {\r\n          \"calcs\": [],\r\n          \"displayMode\": \"list\",\r\n          \"placement\": \"bottom\",\r\n          \"showLegend\": false\r\n        },\r\n        \"maxVizHeight\": 300,\r\n        \"minVizHeight\": 16,\r\n        \"minVizWidth\": 8,\r\n        \"namePlacement\": \"top\",\r\n        \"orientation\": \"horizontal\",\r\n        \"reduceOptions\": {\r\n          \"calcs\": [\r\n            \"lastNotNull\"\r\n          ],\r\n          \"fields\": \"\",\r\n          \"values\": true\r\n        },\r\n        \"showUnfilled\": true,\r\n        \"sizing\": \"auto\",\r\n        \"valueMode\": \"color\"\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"  SELECT\\r\\n    concat(namespace,':',deployment) AS name,\\r\\n    sum(pod_count) AS load\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    name\\r\\n    order by load desc\\r\\n    limit 10\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务Pod数TOP10\",\r\n      \"type\": \"bargauge\"\r\n    },\r\n    {\r\n      \"collapsed\": false,\r\n      \"gridPos\": {\r\n        \"h\": 1,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 16\r\n      },\r\n      \"id\": 24,\r\n      \"panels\": [],\r\n      \"title\": \"命名空间级别最大资源使用分析\",\r\n      \"type\": \"row\"\r\n    },\r\n    {\r\n      \"datasource\": {\r\n        \"type\": \"grafana-clickhouse-datasource\",\r\n        \"uid\": \"KubeDoor-Clickhouse\"\r\n      },\r\n      \"fieldConfig\": {\r\n        \"defaults\": {\r\n          \"color\": {\r\n            \"mode\": \"palette-classic-by-name\"\r\n          },\r\n          \"custom\": {\r\n            \"align\": \"center\",\r\n            \"cellOptions\": {\r\n              \"applyToRow\": false,\r\n              \"type\": \"color-background\",\r\n              \"wrapText\": false\r\n            },\r\n            \"inspect\": false\r\n          },\r\n          \"mappings\": [],\r\n          \"thresholds\": {\r\n            \"mode\": \"absolute\",\r\n            \"steps\": [\r\n              {\r\n                \"color\": \"green\",\r\n                \"value\": null\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        \"overrides\": [\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byRegexp\",\r\n              \"options\": \"/内存.*/\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"unit\",\r\n                \"value\": \"mbytes\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"微服务数\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 88\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"命名空间\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 86\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"微服务%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 88\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"Pod数\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 77\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"Pod%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 76\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU限制\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 91\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"red\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU需求%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 107\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU需求\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 92\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"green\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU限制%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 107\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU负载%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 105\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存需求\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 91\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"green\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"CPU负载\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 93\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"yellow\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存需求%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 102\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byRegexp\",\r\n              \"options\": \"/.*%/\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"unit\",\r\n                \"value\": \"percentunit\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存限制%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 102\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存限制\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 90\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"red\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存使用\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 89\r\n              },\r\n              {\r\n                \"id\": \"custom.cellOptions\",\r\n                \"value\": {\r\n                  \"type\": \"color-text\",\r\n                  \"wrapText\": false\r\n                }\r\n              },\r\n              {\r\n                \"id\": \"color\",\r\n                \"value\": {\r\n                  \"fixedColor\": \"yellow\",\r\n                  \"mode\": \"fixed\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"matcher\": {\r\n              \"id\": \"byName\",\r\n              \"options\": \"内存%\"\r\n            },\r\n            \"properties\": [\r\n              {\r\n                \"id\": \"custom.width\",\r\n                \"value\": 74\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"gridPos\": {\r\n        \"h\": 17,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 17\r\n      },\r\n      \"id\": 10,\r\n      \"options\": {\r\n        \"cellHeight\": \"sm\",\r\n        \"footer\": {\r\n          \"countRows\": false,\r\n          \"fields\": \"\",\r\n          \"reducer\": [\r\n            \"sum\"\r\n          ],\r\n          \"show\": true\r\n        },\r\n        \"frameIndex\": 1,\r\n        \"showHeader\": true,\r\n        \"sortBy\": [\r\n          {\r\n            \"desc\": true,\r\n            \"displayName\": \"CPU负载\"\r\n          }\r\n        ]\r\n      },\r\n      \"pluginVersion\": \"11.4.0\",\r\n      \"targets\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"format\": 1,\r\n          \"meta\": {\r\n            \"builderOptions\": {\r\n              \"fields\": [],\r\n              \"limit\": 100,\r\n              \"mode\": \"list\"\r\n            }\r\n          },\r\n          \"queryType\": \"sql\",\r\n          \"rawSql\": \"-- 计算每个命名空间的值\\r\\nWITH per_namespace AS (\\r\\n  SELECT\\r\\n    namespace,\\r\\n    count(DISTINCT(deployment)) AS deployment,\\r\\n    sum(pod_count) AS pod,\\r\\n    sum(p95_pod_load * pod_count) AS load,\\r\\n    sum(p95_pod_wss_mb * pod_count) AS mem,\\r\\n    sum(request_pod_cpu_m * pod_count/1000) AS cpu_request,\\r\\n    sum(limit_pod_cpu_m * pod_count/1000) AS cpu_limit,\\r\\n    sum(request_pod_mem_mb * pod_count) AS mem_request,\\r\\n    sum(limit_pod_mem_mb * pod_count) AS mem_limit\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}'AND ${env}\\r\\n  GROUP BY\\r\\n    namespace\\r\\n),\\r\\n-- 计算总数\\r\\ntotals AS (\\r\\n  SELECT\\r\\n    sum(deployment) AS total_deployment,\\r\\n    sum(pod) AS total_pod,\\r\\n    sum(load) AS total_load,\\r\\n    sum(mem) AS total_mem,\\r\\n    sum(cpu_request) AS total_cpu_request,\\r\\n    sum(cpu_limit) AS total_cpu_limit,\\r\\n    sum(mem_request) AS total_mem_request,\\r\\n    sum(mem_limit) AS total_mem_limit\\r\\n  FROM\\r\\n    per_namespace\\r\\n) -- 合并并计算占比\\r\\nSELECT\\r\\n  per_namespace.namespace,\\r\\n  per_namespace.deployment,\\r\\n  per_namespace.deployment / totals.total_deployment AS deployment_percentage,\\r\\n  per_namespace.pod,\\r\\n  per_namespace.pod / totals.total_pod AS pod_percentage,\\r\\n\\r\\n  per_namespace.cpu_request,\\r\\n  per_namespace.cpu_request / totals.total_cpu_request AS cpu_request_percentage,\\r\\n  per_namespace.load,\\r\\n  per_namespace.load / totals.total_load AS load_percentage,\\r\\n  per_namespace.cpu_limit,\\r\\n  per_namespace.cpu_limit / totals.total_cpu_limit AS cpu_limit_percentage,\\r\\n\\r\\n  per_namespace.mem_request,\\r\\n  per_namespace.mem_request / totals.total_mem_request AS mem_request_percentage,\\r\\n  per_namespace.mem,\\r\\n  per_namespace.mem / totals.total_mem AS mem_percentage,\\r\\n  per_namespace.mem_limit,\\r\\n  per_namespace.mem_limit / totals.total_mem_limit AS mem_limit_percentage\\r\\n\\r\\nFROM\\r\\n  per_namespace\\r\\n  CROSS JOIN totals\",\r\n          \"refId\": \"A\"\r\n        }\r\n      ],\r\n      \"title\": \"【${__from:date:YYYY-MM-DD}~${__to:date:YYYY-MM-DD}最大资源使用的日期：${maxday}】【各命名空间级别】高峰时段P95资源使用量与资源占整体资源比例\",\r\n      \"transformations\": [\r\n        {\r\n          \"id\": \"seriesToRows\",\r\n          \"options\": {}\r\n        },\r\n        {\r\n          \"id\": \"organize\",\r\n          \"options\": {\r\n            \"excludeByName\": {},\r\n            \"includeByName\": {},\r\n            \"indexByName\": {},\r\n            \"renameByName\": {\r\n              \"cpu_limit\": \"CPU限制\",\r\n              \"cpu_limit_percentage\": \"CPU限制%\",\r\n              \"cpu_request\": \"CPU需求\",\r\n              \"cpu_request_percentage\": \"CPU需求%\",\r\n              \"date\": \"日期\",\r\n              \"deployment\": \"微服务数\",\r\n              \"deployment_percentage\": \"微服务%\",\r\n              \"load\": \"CPU负载\",\r\n              \"load_percentage\": \"CPU负载%\",\r\n              \"mem\": \"内存使用\",\r\n              \"mem_limit\": \"内存限制\",\r\n              \"mem_limit_percentage\": \"内存限制%\",\r\n              \"mem_percentage\": \"内存%\",\r\n              \"mem_request\": \"内存需求\",\r\n              \"mem_request_percentage\": \"内存需求%\",\r\n              \"namespace\": \"命名空间\",\r\n              \"pod\": \"Pod数\",\r\n              \"pod_percentage\": \"Pod%\"\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"type\": \"table\"\r\n    },\r\n    {\r\n      \"collapsed\": true,\r\n      \"gridPos\": {\r\n        \"h\": 1,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 34\r\n      },\r\n      \"id\": 19,\r\n      \"panels\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic-by-name\"\r\n              },\r\n              \"custom\": {\r\n                \"align\": \"center\",\r\n                \"cellOptions\": {\r\n                  \"applyToRow\": false,\r\n                  \"type\": \"color-background\",\r\n                  \"wrapText\": false\r\n                },\r\n                \"filterable\": false,\r\n                \"inspect\": false\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": [\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byRegexp\",\r\n                  \"options\": \"/内存.*/\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"unit\",\r\n                    \"value\": \"mbytes\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"命名空间\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 70\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"Pod数\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 67\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"Pod%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 68\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU限制\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 83\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"red\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU需求%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 107\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU需求\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 86\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"green\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU限制%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 107\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU负载%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 105\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存需求\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 91\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"green\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU负载\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 90\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"yellow\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存需求%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 102\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byRegexp\",\r\n                  \"options\": \"/.*%/\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"unit\",\r\n                    \"value\": \"percentunit\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存限制%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 102\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存限制\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 90\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"red\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存使用\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 89\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"yellow\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 74\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"微服务\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\"\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.filterable\",\r\n                    \"value\": true\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 12,\r\n            \"w\": 24,\r\n            \"x\": 0,\r\n            \"y\": 79\r\n          },\r\n          \"id\": 21,\r\n          \"options\": {\r\n            \"cellHeight\": \"sm\",\r\n            \"footer\": {\r\n              \"countRows\": false,\r\n              \"enablePagination\": false,\r\n              \"fields\": [],\r\n              \"reducer\": [\r\n                \"sum\"\r\n              ],\r\n              \"show\": true\r\n            },\r\n            \"frameIndex\": 1,\r\n            \"showHeader\": true,\r\n            \"sortBy\": [\r\n              {\r\n                \"desc\": false,\r\n                \"displayName\": \"CPU需求\"\r\n              }\r\n            ]\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 1,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"fields\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"-- 计算每个命名空间的值\\r\\nWITH per_namespace AS (\\r\\n  SELECT\\r\\n    namespace,\\r\\n    deployment,\\r\\n    sum(pod_count) AS pod,\\r\\n    sum(p95_pod_load * pod_count) AS load,\\r\\n    sum(p95_pod_wss_mb * pod_count) AS mem,\\r\\n    sum(request_pod_cpu_m * pod_count/1000) AS cpu_request,\\r\\n    sum(limit_pod_cpu_m * pod_count/1000) AS cpu_limit,\\r\\n    sum(request_pod_mem_mb * pod_count) AS mem_request,\\r\\n    sum(limit_pod_mem_mb * pod_count) AS mem_limit\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}' AND ${env} AND ${namespace}\\r\\n  GROUP BY\\r\\n    namespace,deployment\\r\\n),\\r\\n-- 计算总数\\r\\ntotals AS (\\r\\n  SELECT\\r\\n    sum(pod) AS total_pod,\\r\\n    sum(load) AS total_load,\\r\\n    sum(mem) AS total_mem,\\r\\n    sum(cpu_request) AS total_cpu_request,\\r\\n    sum(cpu_limit) AS total_cpu_limit,\\r\\n    sum(mem_request) AS total_mem_request,\\r\\n    sum(mem_limit) AS total_mem_limit\\r\\n  FROM\\r\\n    per_namespace\\r\\n) -- 合并并计算占比\\r\\nSELECT\\r\\n  per_namespace.namespace,\\r\\n  per_namespace.deployment,\\r\\n  per_namespace.pod,\\r\\n  per_namespace.pod / totals.total_pod AS pod_percentage,\\r\\n  per_namespace.cpu_request,\\r\\n  per_namespace.cpu_request / totals.total_cpu_request AS cpu_request_percentage,\\r\\n  per_namespace.load,\\r\\n  per_namespace.load / totals.total_load AS load_percentage,\\r\\n  per_namespace.cpu_limit,\\r\\n  per_namespace.cpu_limit / totals.total_cpu_limit AS cpu_limit_percentage,\\r\\n\\r\\n  per_namespace.mem_request,\\r\\n  per_namespace.mem_request / totals.total_mem_request AS mem_request_percentage,\\r\\n  per_namespace.mem,\\r\\n  per_namespace.mem / totals.total_mem AS mem_percentage,\\r\\n  per_namespace.mem_limit,\\r\\n  per_namespace.mem_limit / totals.total_mem_limit AS mem_limit_percentage\\r\\n\\r\\nFROM\\r\\n  per_namespace\\r\\n  CROSS JOIN totals\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"【${__from:date:YYYY-MM-DD}~${__to:date:YYYY-MM-DD}最大资源使用的日期：${maxday}】【各微服务级别】高峰时段P95资源使用量与资源占整体资源比例\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"seriesToRows\",\r\n              \"options\": {}\r\n            },\r\n            {\r\n              \"id\": \"organize\",\r\n              \"options\": {\r\n                \"excludeByName\": {},\r\n                \"includeByName\": {},\r\n                \"indexByName\": {},\r\n                \"renameByName\": {\r\n                  \"cpu_limit\": \"CPU限制\",\r\n                  \"cpu_limit_percentage\": \"CPU限制%\",\r\n                  \"cpu_request\": \"CPU需求\",\r\n                  \"cpu_request_percentage\": \"CPU需求%\",\r\n                  \"date\": \"日期\",\r\n                  \"deployment\": \"微服务\",\r\n                  \"deployment_percentage\": \"微服务%\",\r\n                  \"load\": \"CPU负载\",\r\n                  \"load_percentage\": \"CPU负载%\",\r\n                  \"mem\": \"内存使用\",\r\n                  \"mem_limit\": \"内存限制\",\r\n                  \"mem_limit_percentage\": \"内存限制%\",\r\n                  \"mem_percentage\": \"内存%\",\r\n                  \"mem_request\": \"内存需求\",\r\n                  \"mem_request_percentage\": \"内存需求%\",\r\n                  \"namespace\": \"命名空间\",\r\n                  \"pod\": \"Pod数\",\r\n                  \"pod_percentage\": \"Pod%\"\r\n                }\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"table\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"percent\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 0,\r\n            \"y\": 91\r\n          },\r\n          \"id\": 4,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Mean\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_cpu_pct) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"每日高峰时段P95CPU使用率\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 8,\r\n            \"y\": 91\r\n          },\r\n          \"id\": 5,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Mean\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_wss_pct) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"每日高峰时段P95内存使用率\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 16,\r\n            \"y\": 91\r\n          },\r\n          \"id\": 2,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Mean\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(pod_count) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"每日微服务Pod数\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"align\": \"center\",\r\n                \"cellOptions\": {\r\n                  \"applyToRow\": false,\r\n                  \"mode\": \"gradient\",\r\n                  \"type\": \"color-background\",\r\n                  \"wrapText\": false\r\n                },\r\n                \"inspect\": false\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": [\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byRegexp\",\r\n                  \"options\": \"/内存.*/\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"unit\",\r\n                    \"value\": \"mbytes\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"命名空间\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 107\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"Pod数\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 81\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"Pod%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 122\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU限制\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 91\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"red\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU需求\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 117\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"green\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存需求\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 104\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"green\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU负载\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 106\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"yellow\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byRegexp\",\r\n                  \"options\": \"/.*%/\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"unit\",\r\n                    \"value\": \"percent\"\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"mode\": \"gradient\",\r\n                      \"type\": \"gauge\",\r\n                      \"valueDisplayMode\": \"color\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"min\",\r\n                    \"value\": 0\r\n                  },\r\n                  {\r\n                    \"id\": \"max\",\r\n                    \"value\": 100\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"mode\": \"continuous-GrYlRd\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"id\": \"decimals\",\r\n                    \"value\": 1\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存限制\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 110\r\n                  },\r\n                  {\r\n                    \"id\": \"color\",\r\n                    \"value\": {\r\n                      \"fixedColor\": \"red\",\r\n                      \"mode\": \"fixed\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存使用\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 103\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.cellOptions\",\r\n                    \"value\": {\r\n                      \"type\": \"color-text\",\r\n                      \"wrapText\": false\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"Pod\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 302\r\n                  },\r\n                  {\r\n                    \"id\": \"custom.filterable\",\r\n                    \"value\": true\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"CPU使用%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 137\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"内存使用%\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 135\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"matcher\": {\r\n                  \"id\": \"byName\",\r\n                  \"options\": \"微服务\"\r\n                },\r\n                \"properties\": [\r\n                  {\r\n                    \"id\": \"custom.width\",\r\n                    \"value\": 320\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 12,\r\n            \"w\": 24,\r\n            \"x\": 0,\r\n            \"y\": 101\r\n          },\r\n          \"id\": 22,\r\n          \"options\": {\r\n            \"cellHeight\": \"sm\",\r\n            \"footer\": {\r\n              \"countRows\": false,\r\n              \"fields\": [\r\n                \"pod\",\r\n                \"cpu_request\",\r\n                \"load\",\r\n                \"cpu_limit\",\r\n                \"mem_request\",\r\n                \"mem\",\r\n                \"mem_limit\",\r\n                \"pod_percentage\"\r\n              ],\r\n              \"reducer\": [\r\n                \"sum\"\r\n              ],\r\n              \"show\": true\r\n            },\r\n            \"frameIndex\": 1,\r\n            \"showHeader\": true,\r\n            \"sortBy\": [\r\n              {\r\n                \"desc\": true,\r\n                \"displayName\": \"CPU使用\"\r\n              }\r\n            ]\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 1,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"fields\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"-- 计算每个命名空间的值\\r\\nWITH per_namespace AS (\\r\\n  SELECT\\r\\n    namespace,\\r\\n    deployment,\\r\\n    sum(pod_count) AS pod,\\r\\n    sum(p95_pod_load) AS load,\\r\\n    sum(p95_pod_wss_mb) AS mem,\\r\\n    sum(p95_pod_cpu_pct) AS cpu_pct,\\r\\n    sum(p95_pod_wss_pct) AS mem_pct,\\r\\n    sum(request_pod_cpu_m/1000) AS cpu_request,\\r\\n    sum(limit_pod_cpu_m/1000) AS cpu_limit,\\r\\n    sum(request_pod_mem_mb) AS mem_request,\\r\\n    sum(limit_pod_mem_mb) AS mem_limit\\r\\n  FROM\\r\\n    kubedoor.${table} PREWHERE date = '${maxday}' AND ${env} AND ${namespace}\\r\\n  GROUP BY\\r\\n    namespace,deployment\\r\\n),\\r\\n-- 计算总数\\r\\ntotals AS (\\r\\n  SELECT\\r\\n    sum(pod) AS total_pod\\r\\n  FROM\\r\\n    per_namespace\\r\\n) -- 合并并计算占比\\r\\nSELECT\\r\\n  per_namespace.namespace,\\r\\n  per_namespace.deployment,\\r\\n  per_namespace.pod,\\r\\n  per_namespace.pod / totals.total_pod * 100 AS pod_percentage,\\r\\n\\r\\n  per_namespace.cpu_request,\\r\\n  per_namespace.load,\\r\\n  per_namespace.cpu_pct,\\r\\n  per_namespace.cpu_limit,\\r\\n\\r\\n  per_namespace.mem_request,\\r\\n  per_namespace.mem,\\r\\n  per_namespace.mem_pct,\\r\\n  per_namespace.mem_limit\\r\\n\\r\\nFROM\\r\\n  per_namespace\\r\\n  CROSS JOIN totals\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"【${__from:date:YYYY-MM-DD}~${__to:date:YYYY-MM-DD}最大资源使用的日期：${maxday}】【各Pod级别】高峰时段P95资源使用量与使用率分析\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"seriesToRows\",\r\n              \"options\": {}\r\n            },\r\n            {\r\n              \"id\": \"organize\",\r\n              \"options\": {\r\n                \"excludeByName\": {},\r\n                \"includeByName\": {},\r\n                \"indexByName\": {\r\n                  \"cpu_limit\": 6,\r\n                  \"cpu_pct\": 7,\r\n                  \"cpu_request\": 4,\r\n                  \"deployment\": 1,\r\n                  \"load\": 5,\r\n                  \"mem\": 9,\r\n                  \"mem_limit\": 10,\r\n                  \"mem_pct\": 11,\r\n                  \"mem_request\": 8,\r\n                  \"namespace\": 0,\r\n                  \"pod\": 2,\r\n                  \"pod_percentage\": 3\r\n                },\r\n                \"renameByName\": {\r\n                  \"cpu_limit\": \"CPU限制\",\r\n                  \"cpu_limit_percentage\": \"CPU限制%\",\r\n                  \"cpu_pct\": \"CPU使用%\",\r\n                  \"cpu_request\": \"CPU需求\",\r\n                  \"cpu_request_percentage\": \"CPU需求%\",\r\n                  \"date\": \"日期\",\r\n                  \"deployment\": \"微服务\",\r\n                  \"deployment_percentage\": \"微服务%\",\r\n                  \"load\": \"CPU负载\",\r\n                  \"load_percentage\": \"CPU负载%\",\r\n                  \"mem\": \"内存使用\",\r\n                  \"mem_limit\": \"内存限制\",\r\n                  \"mem_limit_percentage\": \"内存限制%\",\r\n                  \"mem_pct\": \"内存使用%\",\r\n                  \"mem_percentage\": \"内存%\",\r\n                  \"mem_request\": \"内存需求\",\r\n                  \"mem_request_percentage\": \"内存需求%\",\r\n                  \"namespace\": \"命名空间\",\r\n                  \"pod\": \"Pod数\",\r\n                  \"pod_percentage\": \"Pod%\"\r\n                }\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"table\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务整体分析【$namespace】\",\r\n      \"type\": \"row\"\r\n    },\r\n    {\r\n      \"collapsed\": true,\r\n      \"gridPos\": {\r\n        \"h\": 1,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 35\r\n      },\r\n      \"id\": 7,\r\n      \"panels\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 0,\r\n            \"y\": 711\r\n          },\r\n          \"id\": 8,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Name\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_load * pod_count) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务每日高峰时段P95 CPU负载\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 8,\r\n            \"y\": 711\r\n          },\r\n          \"id\": 14,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(request_pod_cpu_m * pod_count)/1000 FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务CPU需求值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 16,\r\n            \"y\": 711\r\n          },\r\n          \"id\": 12,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(limit_pod_cpu_m * pod_count)/1000 FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务CPU限制值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 0,\r\n            \"y\": 721\r\n          },\r\n          \"id\": 9,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_wss_mb * pod_count) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务每日高峰时段P95 内存使用量\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 8,\r\n            \"y\": 721\r\n          },\r\n          \"id\": 11,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(request_pod_mem_mb * pod_count) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务内存需求值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 16,\r\n            \"y\": 721\r\n          },\r\n          \"id\": 18,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(limit_pod_mem_mb * pod_count) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各微服务内存限制值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        }\r\n      ],\r\n      \"title\": \"微服务资源曲线图【$namespace】\",\r\n      \"type\": \"row\"\r\n    },\r\n    {\r\n      \"collapsed\": true,\r\n      \"gridPos\": {\r\n        \"h\": 1,\r\n        \"w\": 24,\r\n        \"x\": 0,\r\n        \"y\": 36\r\n      },\r\n      \"id\": 6,\r\n      \"panels\": [\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 0,\r\n            \"y\": 324\r\n          },\r\n          \"id\": 1,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Mean\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_load) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod每日高峰时段P95 CPU负载\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 8,\r\n            \"y\": 324\r\n          },\r\n          \"id\": 15,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(request_pod_cpu_m)/1000 FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod CPU需求值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 16,\r\n            \"y\": 324\r\n          },\r\n          \"id\": 16,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(limit_pod_cpu_m)/1000 FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod CPU限制值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 0,\r\n            \"y\": 334\r\n          },\r\n          \"id\": 3,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(p95_pod_wss_mb) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod每日高峰时段P95内存使用量\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 8,\r\n            \"y\": 334\r\n          },\r\n          \"id\": 17,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(request_pod_mem_mb) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod内存需求值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        },\r\n        {\r\n          \"datasource\": {\r\n            \"type\": \"grafana-clickhouse-datasource\",\r\n            \"uid\": \"KubeDoor-Clickhouse\"\r\n          },\r\n          \"fieldConfig\": {\r\n            \"defaults\": {\r\n              \"color\": {\r\n                \"mode\": \"palette-classic\"\r\n              },\r\n              \"custom\": {\r\n                \"axisBorderShow\": false,\r\n                \"axisCenteredZero\": false,\r\n                \"axisColorMode\": \"text\",\r\n                \"axisLabel\": \"\",\r\n                \"axisPlacement\": \"auto\",\r\n                \"barAlignment\": 0,\r\n                \"barWidthFactor\": 0.6,\r\n                \"drawStyle\": \"line\",\r\n                \"fillOpacity\": 0,\r\n                \"gradientMode\": \"none\",\r\n                \"hideFrom\": {\r\n                  \"legend\": false,\r\n                  \"tooltip\": false,\r\n                  \"viz\": false\r\n                },\r\n                \"insertNulls\": false,\r\n                \"lineInterpolation\": \"linear\",\r\n                \"lineWidth\": 1,\r\n                \"pointSize\": 5,\r\n                \"scaleDistribution\": {\r\n                  \"type\": \"linear\"\r\n                },\r\n                \"showPoints\": \"auto\",\r\n                \"spanNulls\": false,\r\n                \"stacking\": {\r\n                  \"group\": \"A\",\r\n                  \"mode\": \"none\"\r\n                },\r\n                \"thresholdsStyle\": {\r\n                  \"mode\": \"off\"\r\n                }\r\n              },\r\n              \"mappings\": [],\r\n              \"thresholds\": {\r\n                \"mode\": \"absolute\",\r\n                \"steps\": [\r\n                  {\r\n                    \"color\": \"green\"\r\n                  },\r\n                  {\r\n                    \"color\": \"red\",\r\n                    \"value\": 80\r\n                  }\r\n                ]\r\n              },\r\n              \"unit\": \"mbytes\"\r\n            },\r\n            \"overrides\": []\r\n          },\r\n          \"gridPos\": {\r\n            \"h\": 10,\r\n            \"w\": 8,\r\n            \"x\": 16,\r\n            \"y\": 334\r\n          },\r\n          \"id\": 13,\r\n          \"options\": {\r\n            \"legend\": {\r\n              \"calcs\": [\r\n                \"last\",\r\n                \"mean\",\r\n                \"max\"\r\n              ],\r\n              \"displayMode\": \"table\",\r\n              \"placement\": \"bottom\",\r\n              \"showLegend\": true,\r\n              \"sortBy\": \"Last\",\r\n              \"sortDesc\": true\r\n            },\r\n            \"tooltip\": {\r\n              \"mode\": \"multi\",\r\n              \"sort\": \"desc\"\r\n            }\r\n          },\r\n          \"pluginVersion\": \"11.4.0\",\r\n          \"targets\": [\r\n            {\r\n              \"builderOptions\": {\r\n                \"database\": \"kubedoor\",\r\n                \"fields\": [],\r\n                \"filters\": [],\r\n                \"limit\": 100,\r\n                \"mode\": \"list\",\r\n                \"orderBy\": [],\r\n                \"table\": \"k8s_resources\"\r\n              },\r\n              \"datasource\": {\r\n                \"type\": \"grafana-clickhouse-datasource\",\r\n                \"uid\": \"KubeDoor-Clickhouse\"\r\n              },\r\n              \"format\": 0,\r\n              \"meta\": {\r\n                \"builderOptions\": {\r\n                  \"database\": \"kubedoor\",\r\n                  \"fields\": [],\r\n                  \"filters\": [],\r\n                  \"limit\": 100,\r\n                  \"mode\": \"list\",\r\n                  \"orderBy\": [],\r\n                  \"table\": \"k8s_resources\"\r\n                }\r\n              },\r\n              \"queryType\": \"sql\",\r\n              \"rawSql\": \"SELECT date as time, deployment, max(limit_pod_mem_mb) FROM kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace} and ${deployment}\\r\\ngroup by time,deployment\\r\\norder by time\\r\\n\",\r\n              \"refId\": \"A\"\r\n            }\r\n          ],\r\n          \"title\": \"各Pod内存限制值\",\r\n          \"transformations\": [\r\n            {\r\n              \"id\": \"renameByRegex\",\r\n              \"options\": {\r\n                \"regex\": \"/.+ (.*)/\",\r\n                \"renamePattern\": \"$1\"\r\n              }\r\n            }\r\n          ],\r\n          \"type\": \"timeseries\"\r\n        }\r\n      ],\r\n      \"title\": \"Pod资源曲线图【$namespace】\",\r\n      \"type\": \"row\"\r\n    }\r\n  ],\r\n  \"preload\": false,\r\n  \"schemaVersion\": 40,\r\n  \"tags\": [\r\n    \"StarsL.cn\"\r\n  ],\r\n  \"templating\": {\r\n    \"list\": [\r\n      {\r\n        \"current\": {\r\n          \"text\": \"k8s_resources_kunlun\",\r\n          \"value\": \"k8s_resources_kunlun\"\r\n        },\r\n        \"datasource\": {\r\n          \"type\": \"grafana-clickhouse-datasource\",\r\n          \"uid\": \"KubeDoor-Clickhouse\"\r\n        },\r\n        \"definition\": \"show tables from kubedoor\",\r\n        \"description\": \"\",\r\n        \"label\": \"数据表\",\r\n        \"name\": \"table\",\r\n        \"options\": [],\r\n        \"query\": \"show tables from kubedoor\",\r\n        \"refresh\": 1,\r\n        \"regex\": \"/^k8s_resources.*/\",\r\n        \"type\": \"query\"\r\n      },\r\n      {\r\n        \"allValue\": \"1 = 1\",\r\n        \"current\": {\r\n          \"text\": \"cassmall-kunlun\",\r\n          \"value\": \"env = 'cassmall-kunlun'\"\r\n        },\r\n        \"datasource\": {\r\n          \"type\": \"grafana-clickhouse-datasource\",\r\n          \"uid\": \"KubeDoor-Clickhouse\"\r\n        },\r\n        \"definition\": \"SELECT\\nconcat(env ,'#env = \\\\'',env,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) \\ngroup by env\",\r\n        \"includeAll\": false,\r\n        \"label\": \"环境\",\r\n        \"name\": \"env\",\r\n        \"options\": [],\r\n        \"query\": \"SELECT\\nconcat(env ,'#env = \\\\'',env,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) \\ngroup by env\",\r\n        \"refresh\": 1,\r\n        \"regex\": \"/(?<text>.*)#(?<value>.*)/\",\r\n        \"sort\": 5,\r\n        \"type\": \"query\"\r\n      },\r\n      {\r\n        \"allValue\": \"1=1\",\r\n        \"current\": {\r\n          \"text\": \"All\",\r\n          \"value\": \"$__all\"\r\n        },\r\n        \"datasource\": {\r\n          \"type\": \"grafana-clickhouse-datasource\",\r\n          \"uid\": \"KubeDoor-Clickhouse\"\r\n        },\r\n        \"definition\": \"SELECT\\nconcat(namespace,'#namespace = \\\\'',namespace,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) and ${env}\\ngroup by namespace\",\r\n        \"description\": \"\",\r\n        \"includeAll\": true,\r\n        \"label\": \"命名空间\",\r\n        \"name\": \"namespace\",\r\n        \"options\": [],\r\n        \"query\": \"SELECT\\nconcat(namespace,'#namespace = \\\\'',namespace,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) and ${env}\\ngroup by namespace\",\r\n        \"refresh\": 1,\r\n        \"regex\": \"/(?<text>.*)#(?<value>.*)/\",\r\n        \"sort\": 5,\r\n        \"type\": \"query\"\r\n      },\r\n      {\r\n        \"allValue\": \"1=1\",\r\n        \"current\": {\r\n          \"text\": \"All\",\r\n          \"value\": \"$__all\"\r\n        },\r\n        \"datasource\": {\r\n          \"type\": \"grafana-clickhouse-datasource\",\r\n          \"uid\": \"KubeDoor-Clickhouse\"\r\n        },\r\n        \"definition\": \"SELECT\\nconcat(deployment,'#deployment = \\\\'',deployment,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace}\\ngroup by deployment\",\r\n        \"includeAll\": true,\r\n        \"label\": \"微服务\",\r\n        \"name\": \"deployment\",\r\n        \"options\": [],\r\n        \"query\": \"SELECT\\nconcat(deployment,'#deployment = \\\\'',deployment,'\\\\'') \\nfrom  kubedoor.${table} PREWHERE $__timeFilter(date) and ${env} and ${namespace}\\ngroup by deployment\",\r\n        \"refresh\": 1,\r\n        \"regex\": \"/(?<text>.*)#(?<value>.*)/\",\r\n        \"sort\": 5,\r\n        \"type\": \"query\"\r\n      },\r\n      {\r\n        \"current\": {\r\n          \"text\": \"2024-11-25\",\r\n          \"value\": \"2024-11-25 11:30:00\"\r\n        },\r\n        \"datasource\": {\r\n          \"type\": \"grafana-clickhouse-datasource\",\r\n          \"uid\": \"KubeDoor-Clickhouse\"\r\n        },\r\n        \"definition\": \"SELECT\\n\\nconcat(formatDateTime(toDateTime(date), '%Y-%m-%d'),'#',formatDateTime(toDateTime(date), '%Y-%m-%d %T'))\\n AS formatted_date\\nFROM\\n    kubedoor.${table}\\nPREWHERE\\n    $__timeFilter(date) AND ${env}\\nGROUP BY\\n    formatted_date\\nORDER BY\\n    SUM(pod_count * p95_pod_load) DESC\\nLIMIT\\n    1\\n\",\r\n        \"description\": \"\",\r\n        \"label\": \"最大资源使用的日期\",\r\n        \"name\": \"maxday\",\r\n        \"options\": [],\r\n        \"query\": \"SELECT\\n\\nconcat(formatDateTime(toDateTime(date), '%Y-%m-%d'),'#',formatDateTime(toDateTime(date), '%Y-%m-%d %T'))\\n AS formatted_date\\nFROM\\n    kubedoor.${table}\\nPREWHERE\\n    $__timeFilter(date) AND ${env}\\nGROUP BY\\n    formatted_date\\nORDER BY\\n    SUM(pod_count * p95_pod_load) DESC\\nLIMIT\\n    1\\n\",\r\n        \"refresh\": 2,\r\n        \"regex\": \"/(?<text>.*)#(?<value>.*)/\",\r\n        \"type\": \"query\"\r\n      }\r\n    ]\r\n  },\r\n  \"time\": {\r\n    \"from\": \"now-30d\",\r\n    \"to\": \"now\"\r\n  },\r\n  \"timepicker\": {},\r\n  \"timezone\": \"Asia/Shanghai\",\r\n  \"title\": \"K8S每日高峰时段资源数据分析\",\r\n  \"uid\": \"KubeDoor\",\r\n  \"version\": 39,\r\n  \"weekStart\": \"\"\r\n}"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubedoor-dash
  namespace: kubedoor
  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: kubedoor
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: kubedoor
      app.kubernetes.io/name: grafana
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: kubedoor
        app.kubernetes.io/name: grafana
    spec:
      volumes:
        - name: grafana-config
          configMap:
            name: kubedoor-grafana-config
        - name: grafana-dash
          configMap:
            name: kubedoor-grafana-dash
        - name: grafana-storage
          emptyDir: {}
        - name: grafana-plugins
          emptyDir: {}
      initContainers:
        - name: grafana-plugins-init
          image: registry.cn-shenzhen.aliyuncs.com/starsl/grafana-plugins-init:0.1.0
          volumeMounts:
            - name: grafana-plugins
              mountPath: /var/lib/grafana/plugins
          imagePullPolicy: Always
      containers:
        - name: grafana
          image: registry.cn-shenzhen.aliyuncs.com/starsl/grafana-oss:11.4.0
          ports:
            - name: grafana
              containerPort: 3000
              protocol: TCP
          env:
            - name: POD_IP
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: status.podIP
            - name: GF_SECURITY_ADMIN_USER
              valueFrom:
                secretKeyRef:
                  name: kubedoor-grafana
                  key: admin-user
            - name: GF_SECURITY_ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: kubedoor-grafana
                  key: admin-password
            - name: GF_PATHS_DATA
              value: /var/lib/grafana/
            - name: GF_PATHS_LOGS
              value: /var/log/grafana
            - name: GF_PATHS_PLUGINS
              value: /var/lib/grafana/plugins
            - name: GF_PATHS_PROVISIONING
              value: /etc/grafana/provisioning
          volumeMounts:
            - name: grafana-storage
              mountPath: /var/lib/grafana
            - name: grafana-config
              mountPath: /etc/grafana/grafana.ini
              subPath: grafana.ini
            - name: grafana-config
              mountPath: /etc/grafana/provisioning/datasources/datasources.yaml
              subPath: datasources.yaml
            - name: grafana-config
              mountPath: /etc/grafana/provisioning/dashboards/dashboardproviders.yaml
              subPath: dashboardproviders.yaml
            - name: grafana-plugins
              mountPath: /var/lib/grafana/plugins
            - name: grafana-dash
              mountPath: /var/lib/grafana/dashboards
          livenessProbe:
            httpGet:
              path: /api/health
              port: 3000
              scheme: HTTP
            initialDelaySeconds: 60
            timeoutSeconds: 30
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          readinessProbe:
            httpGet:
              path: /api/health
              port: 3000
              scheme: HTTP
            timeoutSeconds: 1
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 3
          imagePullPolicy: Always
          securityContext:
            capabilities:
              drop:
                - ALL
            allowPrivilegeEscalation: false
            seccompProfile:
              type: RuntimeDefault
      restartPolicy: Always

---
apiVersion: v1
kind: Service
metadata:
  name: kubedoor-dash
  namespace: kubedoor
  labels:
    app.kubernetes.io/instance: kubedoor
    app.kubernetes.io/name: grafana
spec:
  type: ClusterIP
  ports:
    - name: service
      protocol: TCP
      port: 3000
      targetPort: 3000
  selector:
    app.kubernetes.io/instance: kubedoor
    app.kubernetes.io/name: grafana
